<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saban Pro Kiosk - Ultimate</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --sika-yellow: #FFC500; --sika-red: #E3000F; --sika-black: #111111; }
        body { font-family: 'Heebo', sans-serif; background: #f8fafc; overflow: hidden; user-select: none; }
        
        /* Categories - Professional Icons */
        .cat-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 15px; width: 100px; height: 100px; transition: 0.3s; color: #64748b; font-weight: bold; font-size: 14px; gap: 5px; }
        .cat-btn.active { background: var(--sika-black); color: var(--sika-yellow); border-color: var(--sika-black); transform: scale(1.05); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .cat-btn:hover { border-color: var(--sika-red); color: var(--sika-red); }

        /* Sika AI Robot Container */
        #sikaAiContainer { position: fixed; z-index: 9999; transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); cursor: pointer; }
        
        /* Positions */
        .pos-br { bottom: -20px; right: -20px; }
        .pos-bl { bottom: -20px; left: -20px; }
        .pos-tr { top: -20px; right: -20px; }

        /* States */
        .state-idle { transform: scale(0.8) translateY(50px); opacity: 0.7; }
        .state-peek { animation: peek 5s infinite; }
        .state-active { transform: scale(1) translateY(0); opacity: 1; }
        
        @keyframes peek {
            0%, 90% { transform: scale(0.8) translateY(50px) rotate(0deg); }
            95% { transform: scale(0.9) translateY(0px) rotate(-10deg); }
            100% { transform: scale(0.8) translateY(50px) rotate(0deg); }
        }

        /* Chat & Lead Modal */
        .ai-modal { position: absolute; bottom: 100px; width: 350px; background: white; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); border: 4px solid var(--sika-yellow); overflow: hidden; transform: scale(0); opacity: 0; transition: 0.4s; transform-origin: bottom right; }
        .ai-modal.open { transform: scale(1); opacity: 1; }
        .pos-bl .ai-modal { left: 20px; transform-origin: bottom left; }
        .pos-br .ai-modal { right: 20px; transform-origin: bottom right; }

        /* Typewriter */
        .typing::after { content: '|'; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* Lead Form */
        .lead-input { width: 100%; border: 2px solid #f1f5f9; padding: 12px; border-radius: 12px; margin-bottom: 10px; font-weight: bold; outline: none; transition: 0.3s; }
        .lead-input:focus { border-color: var(--sika-yellow); }
    </style>
</head>
<body class="flex h-screen w-screen bg-gray-50">

    <main class="flex-1 flex flex-col p-8">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-4xl font-black italic tracking-tighter">SABAN <span class="text-[#E3000F]">PRO</span></h1>
            <div class="flex gap-4">
                <button class="cat-btn active"><i data-lucide="droplets" size="28"></i> </button>
                <button class="cat-btn"><i data-lucide="hammer" size="28"></i> 砖拽</button>
                <button class="cat-btn"><i data-lucide="layers" size="28"></i> 专爪祝</button>
                <button class="cat-btn"><i data-lucide="paint-bucket" size="28"></i> 爪注</button>
            </div>
        </header>
        
        <div class="grid grid-cols-4 gap-6">
            <div class="bg-white p-4 rounded-3xl shadow-sm h-64 border border-gray-100 flex items-center justify-center">爪专 1</div>
            <div class="bg-white p-4 rounded-3xl shadow-sm h-64 border border-gray-100 flex items-center justify-center">爪专 2</div>
            <div class="bg-white p-4 rounded-3xl shadow-sm h-64 border border-gray-100 flex items-center justify-center">爪专 3</div>
            <div class="bg-white p-4 rounded-3xl shadow-sm h-64 border border-gray-100 flex items-center justify-center">爪专 4</div>
        </div>
    </main>

    <div id="sikaAiContainer" class="pos-br state-peek" onclick="openSikaInteraction()">
        <img src="https://saban-kiosk-core.pages.dev/admin/sika-ai.png" class="w-48 drop-shadow-2xl hover:scale-110 transition duration-300">
        <div class="absolute -top-10 right-10 bg-white px-4 py-2 rounded-full shadow-lg border-2 border-[#E3000F] font-bold text-sm whitespace-nowrap animate-bounce">
              注专! 
        </div>
        
        <div id="aiModal" class="ai-modal flex flex-col h-[500px]">
            <div class="bg-[#111] p-4 text-white flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-[#FFC500] rounded-full flex items-center justify-center text-black font-bold">Ai</div>
                    <span class="font-bold">Sika Assistant</span>
                </div>
                <button onclick="event.stopPropagation(); closeSikaInteraction()"><i data-lucide="x" size="18"></i></button>
            </div>

            <div class="flex-1 p-6 bg-gray-50 overflow-y-auto relative">
                
                <div id="leadFormPhase">
                    <div class="text-2xl font-black mb-2 text-[#E3000F]">! 转 祝 </div>
                    <p class="text-gray-600 mb-6 text-sm typing" id="leadScriptTarget">
                        注 注 住...
                    </p>
                    
                    <div class="space-y-3">
                        <input type="text" id="leadName" placeholder=" 拽专  ?" class="lead-input">
                        <input type="tel" id="leadPhone" placeholder="住驻专  (注 )" class="lead-input">
                        
                        <label class="flex items-start gap-2 text-xs text-gray-500 cursor-pointer mt-2 bg-white p-2 rounded border border-gray-200">
                            <input type="checkbox" id="marketingConsent" class="mt-1">
                            <span> 砖专 . 住 砖  注, 爪注 驻 拽爪注 爪祝/SMS.</span>
                        </label>

                        <button onclick="submitLead()" class="w-full bg-[#E3000F] text-white py-3 rounded-xl font-bold shadow-lg hover:bg-red-600 transition mt-2">
                            , 住 砖!
                        </button>
                    </div>
                </div>

                <div id="chatPhase" class="hidden h-full flex flex-col">
                    <div id="chatHistory" class="flex-1 space-y-3 overflow-y-auto pb-4">
                        </div>
                    <div class="mt-auto border-t pt-2 flex gap-2">
                        <input id="userMsg" class="w-full border p-2 rounded-lg text-sm" placeholder="砖 转 砖...">
                        <button onclick="sendMessage()" class="bg-black text-white p-2 rounded-lg"><i data-lucide="send" size="16"></i></button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        // --- Logic ---
        let config = {};
        const brain = {}; // Loaded from storage

        function init() {
            // Load from Studio
            const saved = localStorage.getItem('sika_studio_data');
            if(saved) {
                config = JSON.parse(saved);
                
                // Set Position
                const container = document.getElementById('sikaAiContainer');
                container.className = ''; // reset
                container.classList.add(`pos-${config.botPosition}`, 'state-peek');
                
                // Set Script
                document.getElementById('leadScriptTarget').innerText = config.leadScript;
                
                // Load Brain
                if(config.qa) {
                    config.qa.forEach(item => brain[item.q] = item.a);
                }
            } else {
                // Defaults
                document.getElementById('leadScriptTarget').innerText = " 转 祝!  转.\n专注 专注,  '住拽-Ai'.  砖 ? 驻 注专 砖  砖 注  砖转  住祝";
                document.getElementById('sikaAiContainer').classList.add('pos-br', 'state-peek');
            }
        }

        // Interaction Flow
        window.openSikaInteraction = () => {
            const container = document.getElementById('sikaAiContainer');
            const modal = document.getElementById('aiModal');
            
            // Move from Peek to Active
            container.classList.remove('state-peek');
            container.classList.add('state-active');
            
            // Open Modal
            setTimeout(() => {
                modal.classList.add('open');
            }, 200);
        }

        window.closeSikaInteraction = () => {
            const container = document.getElementById('sikaAiContainer');
            const modal = document.getElementById('aiModal');
            
            modal.classList.remove('open');
            setTimeout(() => {
                container.classList.remove('state-active');
                container.classList.add('state-peek');
            }, 300);
        }

        // Lead Submission
        window.submitLead = () => {
            const name = document.getElementById('leadName').value;
            const phone = document.getElementById('leadPhone').value;
            const consent = document.getElementById('marketingConsent').checked;

            if(!name || !phone) return alert(",  砖 驻  砖  转 ?");
            if(!consent) return alert(" 砖专 拽转 注 (拽 住驻 ...)");

            // Save Lead (Mock)
            console.log("Lead Saved:", {name, phone, consent});
            
            // Transition to Chat
            document.getElementById('leadFormPhase').classList.add('hidden');
            document.getElementById('chatPhase').classList.remove('hidden');
            document.getElementById('chatPhase').classList.add('flex');
            
            // Initial Bot Message
            addBotMessage(` ${name}! 转 砖专砖转.    注专  ?`);
        }

        // Chat Logic
        window.sendMessage = () => {
            const input = document.getElementById('userMsg');
            const text = input.value.trim();
            if(!text) return;
            
            // Add User Message
            const history = document.getElementById('chatHistory');
            history.innerHTML += `<div class="flex justify-end"><div class="bg-gray-200 p-2 rounded-lg rounded-br-none text-sm max-w-[80%]">${text}</div></div>`;
            input.value = "";
            history.scrollTop = history.scrollHeight;

            // Brain Search
            let answer = " 拽 专...";
            const key = Object.keys(brain).find(k => text.includes(k));
            
            setTimeout(() => {
                if(key) {
                    answer = brain[key];
                } else {
                    answer = " 爪转 转砖 专 砖,  注专 转 砖   ( -Gemini API)...";
                }
                addBotMessage(answer);
            }, 800);
        }

        function addBotMessage(text) {
            const history = document.getElementById('chatHistory');
            history.innerHTML += `
                <div class="flex gap-2 items-end">
                    <div class="w-6 h-6 bg-[#FFC500] rounded-full flex items-center justify-center text-xs font-bold border border-black">Ai</div>
                    <div class="bg-[#111] text-white p-2 rounded-lg rounded-bl-none text-sm max-w-[80%] shadow-md">${text}</div>
                </div>
            `;
            history.scrollTop = history.scrollHeight;
        }

        init();
    </script>
</body>
</html>
