<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Saban Admin | ×× ×”×œ ×§×˜×œ×•×’ ×—×›×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 p-10 font-sans">

    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="bg-black text-white p-6 flex justify-between items-center">
            <h1 class="text-2xl font-bold flex gap-2"><i data-lucide="bot"></i> ×× ×”×œ ×”×§×˜×œ×•×’ (AI)</h1>
            <div class="text-sm text-gray-400">××—×•×‘×¨ ×œ-Firebase</div>
        </div>

        <div class="p-8">
            <div class="flex gap-4 mb-8">
                <input type="text" id="searchInput" placeholder="×”×§×œ×“ ×©× ××•×¦×¨ (×œ××©×œ: ×¡×™×§×” ×˜×•×¤ 107)" 
                       class="flex-1 p-4 border-2 border-gray-200 rounded-xl text-xl focus:border-yellow-500 outline-none">
                <button onclick="magicFill()" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold px-8 rounded-xl flex items-center gap-2 transition">
                    <i data-lucide="sparkles"></i> ××œ× ××•×˜×•××˜×™×ª
                </button>
            </div>

            <hr class="mb-8">

            <div class="grid grid-cols-2 gap-6">
                <div>
                    <label class="block font-bold mb-1">×©× ××œ×</label>
                    <input type="text" id="pName" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block font-bold mb-1">××•×ª×’</label>
                    <input type="text" id="pBrand" class="w-full p-2 border rounded">
                </div>
                <div class="col-span-2">
                    <label class="block font-bold mb-1">×ª×™××•×¨ ×§×¦×¨</label>
                    <input type="text" id="pShort" class="w-full p-2 border rounded">
                </div>
                <div class="col-span-2">
                    <label class="block font-bold mb-1">×ª×™××•×¨ ××œ× (×˜×›× ×™)</label>
                    <textarea id="pFull" rows="4" class="w-full p-2 border rounded"></textarea>
                </div>
                
                <div class="col-span-2 bg-gray-50 p-4 rounded-xl border">
                    <h3 class="font-bold mb-2">××¤×¨×˜ ×˜×›× ×™ (JSON)</h3>
                    <textarea id="pSpecs" rows="5" class="w-full p-2 border rounded font-mono text-sm"></textarea>
                </div>

                <div class="col-span-2">
                    <label class="block font-bold mb-1">×›×ª×•×‘×ª ×ª××•× ×” (URL)</label>
                    <input type="text" id="pImage" class="w-full p-2 border rounded mb-2">
                    <img id="previewImg" src="" class="h-20 object-contain border p-1 rounded hidden">
                </div>
            </div>

            <button onclick="saveToFirebase()" class="w-full mt-8 bg-black text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 flex justify-center gap-2">
                <i data-lucide="save"></i> ×©××•×¨ ×œ××¡×“ ×”× ×ª×•× ×™×
            </button>
            <div id="statusMsg" class="text-center mt-4 font-bold"></div>
        </div>
    </div>

    <script type="module">
        import { db } from '../../js/firebase-config.js'; // ×•×•×“× ×©×”× ×ª×™×‘ × ×›×•×Ÿ
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { askGeminiAdmin } from '../../js/gemini-service.js';

        lucide.createIcons();
        
        window.magicFill = async () => {
            const query = document.getElementById('searchInput').value;
            if(!query) return alert("×× × ×›×ª×•×‘ ×©× ××•×¦×¨");
            
            document.getElementById('statusMsg').innerText = "ğŸ¤– ×”-AI ×—×•×©×‘...";
            
            // 1. ×§×¨×™××” ×œ-Gemini
            const data = await askGeminiAdmin(query);
            
            if(data) {
                document.getElementById('pName').value = data.name;
                document.getElementById('pShort').value = data.shortDesc;
                document.getElementById('pFull').value = data.fullDesc;
                document.getElementById('pBrand').value = data.brand;
                document.getElementById('pSpecs').value = JSON.stringify(data.specs, null, 2);
                
                // ×”×¢×¨×”: ×ª××•× ×•×ª ××’'××™× ×™ ×”×Ÿ ×œ× ×ª××™×“ ××“×•×™×§×•×ª, ×¢×“×™×£ ×œ×”×“×‘×™×§ ×™×“× ×™×ª ××• ×œ×”×©×ª××© ×‘-Google Custom Search API
                document.getElementById('pImage').placeholder = "×”×“×‘×§ ×›××Ÿ ×œ×™× ×§ ×œ×ª××•× ×”..."; 
                
                document.getElementById('statusMsg').innerText = "âœ… ×”× ×ª×•× ×™× ××•×œ××•! ×‘×“×•×§ ×•×©××•×¨.";
            }
        };

        window.saveToFirebase = async () => {
            try {
                const docData = {
                    name: document.getElementById('pName').value,
                    brand: document.getElementById('pBrand').value,
                    shortDesc: document.getElementById('pShort').value,
                    fullDesc: document.getElementById('pFull').value,
                    image: document.getElementById('pImage').value || "https://via.placeholder.com/300",
                    specs: JSON.parse(document.getElementById('pSpecs').value),
                    price: 0 // ××—×™×¨ ××•×¡×ª×¨
                };

                await addDoc(collection(db, "products"), docData);
                document.getElementById('statusMsg').innerHTML = `<span class="text-green-600">×”××•×¦×¨ × ×©××¨ ×‘×”×¦×œ×—×”!</span>`;
                
                // ××™×¤×•×¡
                setTimeout(() => location.reload(), 2000);
            } catch (e) {
                console.error(e);
                alert("×©×’×™××” ×‘×©××™×¨×”: " + e.message);
            }
        };
    </script>
</body>
</html>
