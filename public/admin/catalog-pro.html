<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Saban Admin | × ×™×”×•×œ ×§×˜×œ×•×’ ×—×›×</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 p-10 font-sans">

    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        
        <div class="bg-black text-white p-6 flex justify-between items-center">
            <h1 class="text-2xl font-bold flex gap-2"><i data-lucide="bot"></i> ×× ×”×œ ×”×§×˜×œ×•×’ (AI)</h1>
            <div class="text-sm text-gray-400 flex items-center gap-2">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                ××—×•×‘×¨ ×œ-Firebase
            </div>
        </div>

        <div class="p-8">
            <div class="bg-yellow-50 p-6 rounded-xl border border-yellow-200 mb-8">
                <label class="font-bold mb-2 block text-yellow-800">×”×•×¡×¤×ª ××•×¦×¨ ×—×“×© (××™×œ×•×™ ××”×™×¨ ×¢× AI)</label>
                <div class="flex gap-4">
                    <input type="text" id="searchInput" placeholder="×”×§×œ×“ ×©× ××•×¦×¨ (×œ××©×œ: ×¡×™×§×” ×˜×•×¤ 107)" 
                           class="flex-1 p-4 border-2 border-white shadow-sm rounded-xl text-xl focus:border-yellow-500 outline-none">
                    <button onclick="magicFill()" class="bg-black text-white hover:bg-gray-800 font-bold px-8 rounded-xl flex items-center gap-2 transition shadow-lg">
                        <i data-lucide="sparkles" class="text-yellow-400"></i> ×©××œ ××ª ×’'××™× ×™
                    </button>
                </div>
                <div id="aiStatus" class="text-sm mt-2 text-gray-500 h-5"></div>
            </div>

            <hr class="mb-8 border-gray-100">

            <div class="grid grid-cols-2 gap-6">
                <div>
                    <label class="block font-bold mb-1 text-gray-700">×©× ××•×¦×¨ ××œ×</label>
                    <input type="text" id="pName" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:border-black transition outline-none">
                </div>
                <div>
                    <label class="block font-bold mb-1 text-gray-700">××•×ª×’</label>
                    <input type="text" id="pBrand" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:border-black transition outline-none">
                </div>

                <div class="col-span-2">
                    <label class="block font-bold mb-1 text-gray-700">×ª×™××•×¨ ×©×™×•×•×§×™ ×§×¦×¨</label>
                    <input type="text" id="pShort" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:border-black transition outline-none">
                </div>
                <div class="col-span-2">
                    <label class="block font-bold mb-1 text-gray-700">×ª×™××•×¨ ×˜×›× ×™ ××œ×</label>
                    <textarea id="pFull" rows="3" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:border-black transition outline-none"></textarea>
                </div>
                
                <div class="col-span-2">
                    <label class="block font-bold mb-1 text-gray-700">×§×™×©×•×¨ ×œ×ª××•× ×” (URL)</label>
                    <div class="flex gap-4">
                        <input type="text" id="pImage" onchange="updatePreview()" class="flex-1 p-3 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:border-black transition outline-none" placeholder="https://...">
                        <img id="previewImg" src="" class="h-12 w-12 object-contain border rounded bg-white hidden">
                    </div>
                </div>

                <div class="col-span-2 bg-gray-900 text-gray-300 p-4 rounded-xl font-mono text-sm">
                    <div class="flex justify-between mb-2">
                        <label class="font-bold text-white">××¤×¨×˜ ×˜×›× ×™ (JSON)</label>
                        <span class="text-xs text-gray-500">×¢×¨×•×š ×‘×–×”×™×¨×•×ª</span>
                    </div>
                    <textarea id="pSpecs" rows="6" class="w-full p-2 bg-black border border-gray-700 rounded text-green-400 outline-none"></textarea>
                </div>
            </div>

            <button onclick="saveToFirebase()" class="w-full mt-8 bg-[#E3000F] text-white py-4 rounded-xl font-bold text-xl hover:bg-red-700 transition flex justify-center gap-2 shadow-xl hover:shadow-2xl transform hover:-translate-y-1">
                <i data-lucide="save"></i> ×©××•×¨ ××•×¦×¨ ×œ××¡×“ ×”× ×ª×•× ×™×
            </button>
            
            <div id="statusMsg" class="text-center mt-4 font-bold h-6"></div>
        </div>
    </div>

    <script type="module">
        import { db } from '../js/firebase-config.js'; // ×™×™×‘×•× ×”×’×“×¨×•×ª Firebase
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { askGeminiAdmin } from '../js/gemini-service.js';

        lucide.createIcons();
        
        // ×¤×•× ×§×¦×™×™×ª ×¢×“×›×•×Ÿ ×ª×¦×•×’×” ××§×“×™××” ×œ×ª××•× ×”
        window.updatePreview = () => {
            const url = document.getElementById('pImage').value;
            const img = document.getElementById('previewImg');
            if(url) { img.src = url; img.classList.remove('hidden'); }
        }

        // ×¤×•× ×§×¦×™×™×ª ×”××™×œ×•×™ ×”×§×¡×•× ×¢× AI
        window.magicFill = async () => {
            const query = document.getElementById('searchInput').value;
            if(!query) return alert("×× × ×›×ª×•×‘ ×©× ××•×¦×¨");
            
            const status = document.getElementById('aiStatus');
            status.innerHTML = `<span class="flex items-center gap-2 text-yellow-600"><i data-lucide="loader-2" class="animate-spin"></i> ×’'××™× ×™ ×× ×ª×— ××ª ×”××•×¦×¨...</span>`;
            lucide.createIcons();
            
            // ×©×œ×™×—×” ×œ-AI
            const data = await askGeminiAdmin(query);
            
            if(data) {
                document.getElementById('pName').value = data.name || query;
                document.getElementById('pShort').value = data.shortDesc || "";
                document.getElementById('pFull').value = data.fullDesc || "";
                document.getElementById('pBrand').value = data.brand || "×›×œ×œ×™";
                document.getElementById('pSpecs').value = JSON.stringify(data.specs || [], null, 2);
                
                status.innerText = "âœ… ×”× ×ª×•× ×™× ××•×œ××•! (×©×™× ×œ×‘: ×™×© ×œ×”×•×¡×™×£ ×ª××•× ×” ×™×“× ×™×ª)";
            } else {
                status.innerText = "âŒ ×©×’×™××” ×‘×§×‘×œ×ª × ×ª×•× ×™×.";
            }
        };

        // ×¤×•× ×§×¦×™×™×ª ×”×©××™×¨×” ×œ-Firebase
        window.saveToFirebase = async () => {
            const btn = document.querySelector('button[onclick="saveToFirebase()"]');
            const originalText = btn.innerHTML;
            
            try {
                // ×‘×“×™×§×•×ª ×ª×§×™× ×•×ª
                const name = document.getElementById('pName').value;
                if(!name) throw new Error("×—×•×‘×” ×œ×”×–×™×Ÿ ×©× ××•×¦×¨");

                let specs = [];
                try {
                    specs = JSON.parse(document.getElementById('pSpecs').value);
                } catch(e) {
                    throw new Error("×©×’×™××” ×‘××‘× ×” ×”-JSON ×©×œ ×”××¤×¨×˜");
                }

                btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin"></i> ×©×•××¨...`;
                lucide.createIcons();

                // ×”××•×‘×™×™×§×˜ ×œ×©××™×¨×”
                const docData = {
                    name: name,
                    brand: document.getElementById('pBrand').value,
                    shortDesc: document.getElementById('pShort').value,
                    fullDesc: document.getElementById('pFull').value,
                    image: document.getElementById('pImage').value || "https://via.placeholder.com/300?text=No+Image",
                    specs: specs,
                    price: 0, // ××—×™×¨ ××•×¡×ª×¨ ×›×¨×’×¢
                    createdAt: new Date()
                };

                // ×©××™×¨×” ×œ×§×•×œ×§×¦×™×™×ª "products"
                await addDoc(collection(db, "products"), docData);
                
                document.getElementById('statusMsg').innerHTML = `<span class="text-green-600">ğŸ‰ ×”××•×¦×¨ × ×©××¨ ×‘×”×¦×œ×—×”!</span>`;
                btn.innerHTML = `<i data-lucide="check"></i> × ×©××¨`;
                
                // ××™×¤×•×¡ ×”×˜×•×¤×¡ ××—×¨×™ 2 ×©× ×™×•×ª
                setTimeout(() => {
                    location.reload();
                }, 2000);

            } catch (e) {
                console.error(e);
                alert("×©×’×™××”: " + e.message);
                btn.innerHTML = originalText;
            }
        };
    </script>
</body>
</html>
