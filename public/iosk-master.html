<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saban Pro Kiosk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --sika-yellow: #FFC500; --sika-red: #E3000F; --sika-black: #111111; --glass-bg: rgba(255, 255, 255, 0.98); }
        body { font-family: 'Heebo', sans-serif; background: #f0f2f5; overflow: hidden; user-select: none; }
        
        /* Robot & Chat Styling */
        #sikaAiWrapper { position: fixed; z-index: 9999; transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); pointer-events: none; }
        .robot-character { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 10px 30px rgba(0,0,0,0.4)); transition: all 0.5s; pointer-events: auto; cursor: pointer; }
        .robot-character:hover { transform: scale(1.05) rotate(-5deg); }
        .breathing-effect { animation: breathe 4s ease-in-out infinite; }
        @keyframes breathe { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        .state-corner { bottom: -20px; right: -20px; width: 280px; height: 280px; }
        .state-active { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 0; height: 0; }
        .state-active .robot-character { position: fixed; bottom: 50px; right: 100px; width: 220px; opacity: 1; }

        #aiWindow { position: absolute; background: var(--glass-bg); border-radius: 30px; box-shadow: 0 40px 80px rgba(0,0,0,0.5); border: 4px solid var(--sika-yellow); overflow: hidden; display: flex; flex-direction: column; opacity: 0; transform: scale(0) translate(-50%, -50%); pointer-events: auto; transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .state-active #aiWindow { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 550px; height: 700px; max-width: 90vw; max-height: 80vh; opacity: 1; }

        /* Typing Indicator */
        .typing-dots span { width: 8px; height: 8px; background: #888; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* Special Messages */
        .msg-expert { border-right: 4px solid var(--sika-red); background: #fff5f5 !important; }
        .expert-btn { background: #25D366; color: white; padding: 10px; border-radius: 10px; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: bold; width: 100%; animation: pulse 2s infinite; }
        
        /* ... Other CSS ... */
        .sidebar-btn { @apply flex flex-col items-center justify-center p-4 text-gray-400 rounded-2xl transition-all duration-300 hover:bg-white hover:text-black hover:shadow-md mb-4 w-full; }
        .sidebar-btn.active { @apply bg-[#111] text-[#FFC500] shadow-lg transform scale-105; }
        .product-card { @apply bg-white rounded-3xl overflow-hidden shadow-sm hover:shadow-2xl transition-all duration-300 border border-transparent hover:border-[#E3000F] h-80 flex flex-col cursor-pointer; }
    </style>
</head>
<body class="flex h-screen w-screen" onload="init()">

    <nav class="w-32 bg-white h-full flex flex-col items-center py-8 shadow-2xl z-40 relative">
        <div class="mb-8 w-24 h-24 bg-white rounded-2xl flex items-center justify-center p-2 shadow-sm border border-gray-100">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRR1_PVzqyK74L9l5eC5grCsPGCsTinQnmHvw&s" class="w-full h-full object-contain">
        </div>
        <button class="sidebar-btn active"><i data-lucide="layout-grid" size="32"></i><span class="text-xs font-bold mt-2">×§×˜×œ×•×’</span></button>
    </nav>

    <main class="flex-1 p-8 bg-gray-50 overflow-y-auto">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-5xl font-black text-gray-900">Saban Pro</h1>
            <input class="bg-white p-4 rounded-2xl w-1/3 shadow-sm text-lg" placeholder="×—×™×¤×•×©...">
        </header>
        <div id="productGrid" class="grid grid-cols-4 gap-6"></div>
    </main>

    <div id="sikaAiWrapper" class="state-corner">
        <img class="robot-character breathing-effect" src="https://saban-kiosk-core.pages.dev/admin/sika-ai.png" onclick="openChat()">
        
        <div id="aiWindow">
            <div class="bg-[#111] p-4 text-white flex justify-between items-center shrink-0">
                <div class="flex items-center gap-2">
                    <div class="w-10 h-10 bg-[#FFC500] rounded-full flex items-center justify-center text-black font-bold">Ai</div>
                    <span class="font-bold text-lg">Sika Expert</span>
                </div>
                <button onclick="closeChat()"><i data-lucide="x"></i></button>
            </div>

            <div class="flex-1 p-6 overflow-y-auto flex flex-col bg-white" id="chatArea">
                <div id="leadForm" class="flex flex-col h-full justify-center text-center">
                    <h3 class="text-3xl font-black mb-4">×‘×•× × ×ª×—×™×œ! ğŸš€</h3>
                    <input id="leadName" class="bg-gray-50 border p-4 rounded-xl mb-4 text-lg" placeholder="×©××š?">
                    <button onclick="startChat()" class="bg-[#E3000F] text-white py-4 rounded-xl font-bold text-xl shadow-lg">×›× ×™×¡×” ×œ×©×™×—×”</button>
                </div>

                <div id="messages" class="hidden flex-col gap-4 pb-4"></div>
            </div>

            <div id="inputArea" class="hidden p-4 border-t bg-gray-50 flex gap-2">
                <input id="userMsg" class="flex-1 border p-3 rounded-xl outline-none focus:border-[#E3000F]" placeholder="×›×ª×•×‘ ×›××Ÿ...">
                <button onclick="send()" class="bg-[#111] text-white p-3 rounded-xl"><i data-lucide="send"></i></button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let clientName = "";
        
        // Mock Brain (This would come from localStorage in real implementation)
        const brain = [
            { trigger: "××—×™×¨", type: "text", content: "×”××—×™×¨×™× ×‘×§×•×¤×” ××©×ª× ×™× ×œ×¤×™ ×›××•×ª. ×× ×™ ×™×›×•×œ ×œ×‘×“×•×§ ×œ×š ×–××™× ×•×ª!" },
            { trigger: "××•××—×”", type: "expert", content: "××—×™, ×”×‘×§×©×” ×©×œ×š ×¦×¨×™×›×” ××•××—×” ×‘×›×™×¨. ×–×” ×¢× ×™×™×Ÿ ×œ××œ×™ ××¡×™×§×” - ×”×•× ××©×¤×—×”!" },
            { trigger: "××œ×™", type: "expert", content: "××™×Ÿ ×‘×¢×™×”, ×× ×™ ××§×¤×™×¥ ××ª ××œ×™." }
        ];

        function init() {
            // Render Products (Mock)
            document.getElementById('productGrid').innerHTML = Array(8).fill(0).map((_,i) => 
                `<div class="product-card bg-white p-4"><div class="h-32 bg-gray-100 rounded-xl mb-4"></div><div class="font-bold text-lg">××•×¦×¨ ${i+1}</div></div>`
            ).join('');
        }

        // --- CHAT LOGIC ---
        function openChat() {
            document.getElementById('sikaAiWrapper').classList.remove('state-corner');
            document.getElementById('sikaAiWrapper').classList.add('state-active');
        }

        function closeChat() {
            document.getElementById('sikaAiWrapper').classList.remove('state-active');
            document.getElementById('sikaAiWrapper').classList.add('state-corner');
        }

        function startChat() {
            clientName = document.getElementById('leadName').value || "×—×‘×¨";
            document.getElementById('leadForm').classList.add('hidden');
            document.getElementById('messages').classList.remove('hidden');
            document.getElementById('messages').classList.add('flex');
            document.getElementById('inputArea').classList.remove('hidden');
            
            addBotMsg(`××”×œ×Ÿ ${clientName}! ×× ×™ ×¡×™×§×”-AI. ××™×š ×× ×™ ×™×›×•×œ ×œ×¢×–×•×¨?`);
        }

        function send() {
            const text = document.getElementById('userMsg').value;
            if(!text) return;
            
            // Add User Msg
            const msgs = document.getElementById('messages');
            msgs.innerHTML += `<div class="self-end bg-black text-white p-3 rounded-2xl rounded-br-none max-w-[80%]">${text}</div>`;
            document.getElementById('userMsg').value = "";
            msgs.scrollTop = msgs.scrollHeight;

            // Typing Effect
            showTyping();

            setTimeout(() => {
                removeTyping();
                checkBrain(text);
            }, 1500);
        }

        function checkBrain(text) {
            const rule = brain.find(r => text.includes(r.trigger));
            
            if (rule) {
                if (rule.type === 'expert') {
                    // Expert Protocol
                    addBotMsg(`××—×™ ${clientName}, ${rule.content}`, 'expert');
                    setTimeout(() => {
                        addBotMsg(`×× ×™ ×©×•×œ×— ×”×ª×¨××” ×œ××¤×œ×™×§×¦×™×” ×©×œ ××œ×™... ğŸ“¡`);
                        setTimeout(() => {
                            const msgs = document.getElementById('messages');
                            msgs.innerHTML += `
                                <div class="self-start bg-green-50 border border-green-200 p-4 rounded-2xl max-w-[90%]">
                                    <div class="font-bold text-green-800 mb-2">âœ… × ×©×œ×—×” ×§×¨×™××” ×œ××œ×™!</div>
                                    <div class="text-sm text-gray-600">×”×•× ×§×™×‘×œ ××ª ×”×”×•×“×¢×”: "××—×™ ××œ×™, ×—×‘×¨ ×©×œ× ×• ${clientName} ×¦×¨×™×š ×¢×–×¨×” ×“×—×•×¤×”."</div>
                                    <a href="https://wa.me/972544527513?text=${encodeURIComponent('×”×™×™ ××œ×™, ×× ×™ ×‘×—× ×•×ª ×•×¦×¨×™×š ×¢×–×¨×”')}" target="_blank" class="expert-btn">
                                        <i data-lucide="message-circle"></i> ×¤×ª×— ×•×•××˜×¡××¤ ××•×œ ××œ×™
                                    </a>
                                </div>`;
                            lucide.createIcons();
                            msgs.scrollTop = msgs.scrollHeight;
                        }, 2000);
                    }, 1000);
                } else {
                    addBotMsg(rule.content);
                }
            } else {
                // Fallback (Gemini Mock)
                addBotMsg("×× ×™ ×‘×•×“×§ ××ª ×–×” ×‘××¤×¨×˜ ×”×˜×›× ×™... ×¨×’×¢ ××—×“.");
            }
        }

        function addBotMsg(text, type='normal') {
            const msgs = document.getElementById('messages');
            const bgClass = type === 'expert' ? 'msg-expert' : 'bg-gray-100';
            msgs.innerHTML += `
                <div class="self-start ${bgClass} p-3 rounded-2xl rounded-bl-none max-w-[85%] text-gray-800 shadow-sm flex gap-2">
                    <div class="w-6 h-6 bg-[#FFC500] rounded-full flex-shrink-0 flex items-center justify-center text-xs border border-black">ğŸ¤–</div>
                    <div>${text}</div>
                </div>`;
            msgs.scrollTop = msgs.scrollHeight;
        }

        function showTyping() {
            const msgs = document.getElementById('messages');
            msgs.innerHTML += `
                <div id="typingIndicator" class="self-start bg-gray-100 p-3 rounded-2xl rounded-bl-none w-16">
                    <div class="typing-dots"><span></span><span></span><span></span></div>
                </div>`;
            msgs.scrollTop = msgs.scrollHeight;
        }

        function removeTyping() {
            const el = document.getElementById('typingIndicator');
            if(el) el.remove();
        }
    </script>
</body>
</html>
