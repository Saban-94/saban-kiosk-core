<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Sika Kiosk Dynamic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Heebo', sans-serif; background: #f8fafc; overflow: hidden; user-select: none; }
        
        /* Layout */
        .sidebar { width: 120px; background: white; height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px; box-shadow: 4px 0 15px rgba(0,0,0,0.05); z-index: 50; }
        .main { flex: 1; padding: 30px; display: flex; flex-direction: column; height: 100vh; position: relative; z-index: 10; }
        
        /* Brand Scroller */
        .brand-scroll { display: flex; gap: 15px; overflow-x: auto; padding: 10px 5px; scrollbar-width: none; align-items: center; }
        .brand-pill { 
            background: white; padding: 8px 25px; border-radius: 50px; cursor: pointer; 
            border: 2px solid transparent; transition: 0.3s; opacity: 0.7; 
            filter: grayscale(100%); min-width: 120px; height: 60px; 
            display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .brand-pill img { height: 35px; object-fit: contain; }
        .brand-pill.active { opacity: 1; border-color: #2563eb; transform: scale(1.1); filter: grayscale(0%); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        /* Products Grid */
        .grid-prods { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; overflow-y: auto; padding-bottom: 150px; }
        .card { background: white; border-radius: 20px; overflow: hidden; height: 360px; box-shadow: 0 5px 10px rgba(0,0,0,0.03); transition: 0.3s; display: flex; flex-direction: column; cursor: pointer; border: 2px solid transparent; }
        .card:hover { transform: translateY(-8px); border-color: #2563eb; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .card-img { height: 60%; display: flex; align-items: center; justify-content: center; background: #fff; padding: 20px; }
        .card-img img { max-height: 100%; max-width: 100%; object-fit: contain; }

        /* Sidebar Buttons */
        .s-btn { width: 100%; aspect-ratio: 1; border-radius: 16px; margin-bottom: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94a3b8; transition: 0.3s; cursor: pointer; border: 2px solid transparent; }
        .s-btn.active { background: #111; color: white; transform: scale(1.1); box-shadow: 0 10px 20px rgba(0,0,0,0.2); border: none; }
        .s-btn:hover { color: #111; border-color: #111; }

        /* Robot & Chat */
        #robotWrap { position: fixed; z-index: 100; transition: 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); pointer-events: none; }
        .pos-corner { bottom: -30px; right: -30px; }
        .pos-center { bottom: 50%; right: 50%; transform: translate(50%, 50%); }
        
        .robot-img { width: 250px; cursor: pointer; transition: 0.5s; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2)); pointer-events: auto; animation: float 4s infinite ease-in-out; }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
        
        .pos-center .robot-img { position: absolute; bottom: -250px; right: 350px; width: 220px; pointer-events: none; }

        #chatWin { 
            position: absolute; background: rgba(255,255,255,0.98); backdrop-filter: blur(20px);
            width: 600px; height: 750px; border-radius: 30px; 
            box-shadow: 0 50px 100px rgba(0,0,0,0.5); border: 4px solid #2563eb;
            opacity: 0; transform: scale(0.8) translate(-50%, -50%); pointer-events: auto;
            display: flex; flex-direction: column; overflow: hidden; transition: 0.5s;
        }
        .pos-center #chatWin { opacity: 1; transform: scale(1) translate(-50%, -50%); top: 50%; left: 50%; }

        /* Keyboard */
        .keyboard { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; padding: 10px; background: #f1f5f9; border-top: 1px solid #e2e8f0; }
        .key { background: white; padding: 12px; border-radius: 8px; text-align: center; font-weight: bold; cursor: pointer; box-shadow: 0 2px 0 #cbd5e1; font-size: 18px; }
        .key:active { transform: translateY(2px); box-shadow: none; }
        .key.space { grid-column: span 5; }
        .key.action { background: #2563eb; color: white; grid-column: span 2; }

        .hidden-tab { display: none; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal.open { display: flex; }
    </style>
</head>
<body class="flex" onload="init()">

    <div class="sidebar">
        <div class="mb-8 w-16 h-16 bg-white rounded-xl shadow-inner flex items-center justify-center border border-gray-100">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRR1_PVzqyK74L9l5eC5grCsPGCsTinQnmHvw&s" class="w-full h-full object-contain">
        </div>
        <div onclick="tab('catalog')" id="tab-catalog" class="s-btn active"><i data-lucide="layout-grid" size="28"></i><span class="text-[10px] font-bold mt-1">×§×˜×œ×•×’</span></div>
        <div onclick="tab('calc')" id="tab-calc" class="s-btn"><i data-lucide="calculator" size="28"></i><span class="text-[10px] font-bold mt-1">××—×©×‘×•×Ÿ</span></div>
        <div onclick="tab('tuts')" id="tab-tuts" class="s-btn"><i data-lucide="film" size="28"></i><span class="text-[10px] font-bold mt-1">×”×“×¨×›×•×ª</span></div>
        <div onclick="openChat()" class="s-btn mt-auto text-yellow-500 border-yellow-400 hover:text-yellow-600"><i data-lucide="bot" size="32"></i><span class="text-[10px] font-bold mt-1">Ai</span></div>
    </div>

    <div class="main">
        <div class="flex justify-between items-center mb-6">
            <div><h1 class="text-5xl font-black text-gray-900" id="mainTitle">×”××¨×›×– ×”××§×¦×•×¢×™</h1><p class="text-xl text-gray-400 font-medium" id="subTitle">×‘×—×¨ ××•×ª×’ ×›×“×™ ×œ×”×ª×—×™×œ</p></div>
            <div class="relative w-[400px]">
                <input id="search" oninput="filter()" class="w-full p-4 pr-12 rounded-2xl border shadow-sm outline-none font-bold" placeholder="×—×™×¤×•×©...">
                <i data-lucide="search" class="absolute right-4 top-4 text-gray-400"></i>
            </div>
        </div>

        <div class="brand-scroll" id="brandList">
            </div>

        <div id="v-catalog" class="flex-1 overflow-y-auto pb-32">
            <div id="grid" class="grid-prods"></div>
        </div>

        <div id="v-calc" class="hidden-tab h-full flex items-center justify-center">
            <div class="bg-white p-12 rounded-[40px] shadow-xl border-4 border-gray-100 text-center w-[600px]">
                <h2 class="text-4xl font-black mb-8">××—×©×‘×•×Ÿ ×›××•×™×•×ª</h2>
                <div class="space-y-4 mb-8">
                    <input id="cA" type="number" class="w-full p-4 border rounded-xl text-center text-xl" placeholder="×©×˜×— (×''×¨)">
                    <input id="cC" type="number" class="w-full p-4 border rounded-xl text-center text-xl" placeholder="×¦×¨×™×›×” (×§''×’ ×œ×''×¨)">
                </div>
                <div class="text-6xl font-black mb-6" id="res">0 <span class="text-2xl text-gray-400">×§"×’</span></div>
                <button onclick="calc()" class="w-full bg-black text-white py-4 rounded-xl font-bold text-xl">×—×©×‘</button>
            </div>
        </div>

        <div id="v-tuts" class="hidden-tab h-full overflow-y-auto">
            <h2 class="text-3xl font-bold mb-4">×”×“×¨×›×•×ª ×•×™×“××•</h2>
            <div id="tutGrid" class="grid grid-cols-3 gap-6"></div>
        </div>
    </div>

    <div id="robotWrap" class="pos-corner">
        <img src="https://saban-kiosk-core.pages.dev/admin/sika-ai.png" class="robot-img" onclick="openChat()">
        
        <div id="aiWindow">
            <div class="bg-[#111] p-4 text-white flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center text-black font-bold border-2 border-white">Ai</div>
                    <span class="font-bold text-lg">Sika Expert</span>
                </div>
                <button onclick="closeChat()"><i data-lucide="x"></i></button>
            </div>
            
            <div class="flex-1 p-6 bg-white overflow-y-auto" id="chatLog">
                <div class="bg-gray-100 p-4 rounded-2xl rounded-tr-none w-fit shadow-sm">×”×™×™! ×× ×™ ×›××Ÿ ×œ×¢×–×•×¨. ×‘××” × ×ª××§×“ ×”×™×•×?</div>
            </div>
            
            <div class="border-t p-2">
                <input id="chatIn" class="w-full p-3 rounded-xl bg-gray-50 border outline-none font-bold text-lg mb-2" placeholder="×”×§×œ×“ ×›××Ÿ..." readonly>
                <div class="keyboard">
                    <div class="key" onclick="k('×§')">×§</div><div class="key" onclick="k('×¨')">×¨</div><div class="key" onclick="k('×')">×</div><div class="key" onclick="k('×˜')">×˜</div><div class="key" onclick="k('×•')">×•</div><div class="key" onclick="k('×Ÿ')">×Ÿ</div><div class="key" onclick="k('×')">×</div><div class="key" onclick="k('×¤')">×¤</div><div class="key" onclick="k('1')">1</div><div class="key" onclick="k('2')">2</div>
                    <div class="key" onclick="k('×©')">×©</div><div class="key" onclick="k('×“')">×“</div><div class="key" onclick="k('×’')">×’</div><div class="key" onclick="k('×›')">×›</div><div class="key" onclick="k('×¢')">×¢</div><div class="key" onclick="k('×™')">×™</div><div class="key" onclick="k('×—')">×—</div><div class="key" onclick="k('×œ')">×œ</div><div class="key" onclick="k('×š')">×š</div><div class="key" onclick="k('×£')">×£</div>
                    <div class="key" onclick="k('×–')">×–</div><div class="key" onclick="k('×¡')">×¡</div><div class="key" onclick="k('×‘')">×‘</div><div class="key" onclick="k('×”')">×”</div><div class="key" onclick="k('× ')">× </div><div class="key" onclick="k('×')">×</div><div class="key" onclick="k('×¦')">×¦</div><div class="key" onclick="k('×ª')">×ª</div><div class="key" onclick="k('×¥')">×¥</div><div class="key" onclick="bs()">âŒ«</div>
                    <div class="key" onclick="k('ğŸ˜Š')">ğŸ˜Š</div><div class="key" onclick="k('ğŸ‘')">ğŸ‘</div><div class="key" onclick="k('ğŸ”¥')">ğŸ”¥</div><div class="key space" onclick="k(' ')">×¨×•×•×—</div><div class="key action" onclick="send()">×©×œ×— ğŸš€</div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="bg-white w-[85vw] h-[80vh] rounded-[40px] flex overflow-hidden relative shadow-2xl">
            <button onclick="document.getElementById('modal').classList.remove('open')" class="absolute top-6 left-6 p-3 bg-gray-100 rounded-full hover:bg-gray-200 z-10"><i data-lucide="x"></i></button>
            <div class="w-1/2 bg-gray-50 flex items-center justify-center p-10"><img id="mImg" class="max-w-full max-h-full mix-blend-multiply"></div>
            <div class="w-1/2 p-14 overflow-y-auto flex flex-col">
                <h2 class="text-6xl font-black mb-6" id="mTitle"></h2>
                <p class="text-2xl text-gray-500 mb-8" id="mDesc"></p>
                <div class="grid grid-cols-3 gap-4 text-center mb-8">
                    <div class="bg-gray-50 p-4 rounded-xl"><div class="text-sm font-bold text-gray-400">×›×™×¡×•×™</div><div class="text-xl font-bold" id="mCov">-</div></div>
                    <div class="bg-gray-50 p-4 rounded-xl"><div class="text-sm font-bold text-gray-400">×™×™×‘×•×©</div><div class="text-xl font-bold" id="mDry">-</div></div>
                    <div class="bg-gray-50 p-4 rounded-xl"><div class="text-sm font-bold text-gray-400">×¢×•×‘×™</div><div class="text-xl font-bold" id="mThick">-</div></div>
                </div>
                <button onclick="askExpert()" class="mt-auto bg-black text-white py-5 rounded-2xl text-2xl font-bold shadow-lg hover:scale-105 transition">×©××œ ××ª ×”××•××—×”</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { db } from './js/firebase-config.js';
        import { collection, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        
        lucide.createIcons();
        let prods = [], brands = [], currentProd = null;

        window.init = async () => {
            // Load Brands Dynamically
            onSnapshot(collection(db, "brands"), snap => {
                brands = [];
                const list = document.getElementById('brandList');
                list.innerHTML = `<div onclick="filter('all', this)" class="brand-pill active">×”×›×œ</div>`;
                snap.forEach(d => {
                    const b = d.data();
                    list.innerHTML += `<div onclick="filter('${b.name}', this)" class="brand-pill"><img src="${b.logo}"></div>`;
                    brands.push(b);
                });
            });

            // Load Products
            const snap = await getDocs(collection(db, "products"));
            snap.forEach(d => prods.push({id:d.id, ...d.data()}));
            render(prods);
            
            // Load Tutorials
            const tSnap = await getDocs(collection(db, "tutorials"));
            const tGrid = document.getElementById('tutGrid');
            tSnap.forEach(d => {
                const t = d.data();
                let vidId = ""; try{ vidId = t.url.split('v=')[1].split('&')[0]; }catch(e){}
                tGrid.innerHTML += `<div class="bg-white rounded-xl overflow-hidden shadow-sm" onclick="window.open('${t.url}')"><img src="https://img.youtube.com/vi/${vidId}/mqdefault.jpg" class="w-full aspect-video object-cover"><div class="p-3 font-bold">${t.title}</div></div>`;
            });
        };

        window.render = (list) => {
            document.getElementById('grid').innerHTML = list.map(p => `
                <div class="card" onclick="openP('${p.id}')">
                    <div class="card-img"><img src="${p.image}"></div>
                    <div class="p-5 border-t">
                        <div class="text-xs text-gray-400 font-bold uppercase mb-1">${p.brand}</div>
                        <h3 class="text-xl font-black leading-tight">${p.name}</h3>
                    </div>
                </div>`).join('');
        };

        window.filter = (bName, el) => {
            document.querySelectorAll('.brand-pill').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
            
            const brand = brands.find(b => b.name === bName);
            if(brand) {
                document.getElementById('mainTitle').innerText = brand.name.toUpperCase();
                document.getElementById('subTitle').innerText = brand.slogan || "××•×¦×¨×™ ××™×›×•×ª";
            } else {
                document.getElementById('mainTitle').innerText = "×”××¨×›×– ×”××§×¦×•×¢×™";
                document.getElementById('subTitle').innerText = "×‘×—×¨ ××•×ª×’ ×›×“×™ ×œ×”×ª×—×™×œ";
            }
            
            render(bName === 'all' ? prods : prods.filter(p => p.brand === bName));
        };

        window.openP = (id) => {
            currentProd = prods.find(x => x.id === id);
            document.getElementById('mTitle').innerText = currentProd.name;
            document.getElementById('mDesc').innerText = currentProd.marketingDesc;
            document.getElementById('mImg').src = currentProd.image;
            document.getElementById('mCov').innerText = currentProd.tech?.coverage || '-';
            document.getElementById('mDry').innerText = currentProd.tech?.drying || '-';
            document.getElementById('mThick').innerText = currentProd.tech?.thickness || '-';
            document.getElementById('modal').classList.add('open');
        };

        // Chat
        window.openChat = () => {
            document.getElementById('sikaAiWrapper').classList.remove('pos-corner');
            document.getElementById('sikaAiWrapper').classList.add('pos-center');
        };
        window.closeChat = () => {
            document.getElementById('sikaAiWrapper').classList.remove('pos-center');
            document.getElementById('sikaAiWrapper').classList.add('pos-corner');
        };
        window.askExpert = () => {
            document.getElementById('modal').classList.remove('open');
            openChat();
            setTimeout(() => addLog(`×× ×™ ×¨×•××” ×©××ª×” ××ª×¢× ×™×™×Ÿ ×‘-${currentProd.name}. ××” ×ª×¨×¦×” ×œ×“×¢×ª?`, 'bot'), 600);
        };
        
        // Keyboard
        window.k = (char) => document.getElementById('chatIn').value += char;
        window.bs = () => { const i = document.getElementById('chatIn'); i.value = i.value.slice(0,-1); };
        window.send = () => {
            const txt = document.getElementById('chatIn').value;
            if(!txt) return;
            addLog(txt, 'user');
            document.getElementById('chatIn').value = "";
            setTimeout(() => addLog("×× ×™ ×‘×•×“×§ ××ª ×–×” ×‘××¤×¨×˜ ×”×˜×›× ×™... (×¡×™××•×œ×¦×™×”)", 'bot'), 1000);
        };
        function addLog(txt, who) {
            const d = document.createElement('div');
            d.className = who === 'bot' ? "bg-gray-100 p-4 rounded-2xl rounded-tr-none w-fit mb-2 shadow-sm" : "bg-blue-600 text-white p-4 rounded-2xl rounded-tl-none w-fit mb-2 mr-auto shadow-md";
            d.innerText = txt;
            document.getElementById('chatLog').appendChild(d);
        }

        window.tab = (t) => {
            document.querySelectorAll('.s-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            ['catalog', 'calc', 'tuts'].forEach(v => document.getElementById('v-'+v).classList.add('hidden-tab'));
            document.getElementById('v-'+t).classList.remove('hidden-tab');
        };
        
        window.calc = () => {
            const a = document.getElementById('cA').value, c = document.getElementById('cC').value;
            if(a && c) document.getElementById('res').innerHTML = (a*c).toFixed(1) + ' ×§"×’';
        };

        window.init = init;
    </script>
</body>
</html>
